services:
  inception-cpu:
    container_name: inception-cpu
    build:
      context: ./inception
      args:
        TARGET_ENV: dev
        BASE_IMAGE: ubuntu:24.04
        UV_SYNC_FLAGS: "-v"
    image: inception-cpu
    profiles: ["m1", "cpu", "default", "demo"]
    environment:
      - TRANSFORMER_MODEL_NAME=freelawproject/modernbert-embed-base_finetune_512
      - MAX_BATCH_SIZE=32
    ports:
      - "8005:8005"
    networks:
      default:
        aliases:
          - inception

  doctor:
    container_name: doctor
    build:
      context: ./doctor
      dockerfile: ./docker/Dockerfile
    profiles: ["doctor", "demo"]
    environment:
      - DOCTOR_WORKERS=18
    ports:
      - "5050:5050"
    networks:
      - default

  client:
    container_name: inception-client
    build: ./client
    image: inception-demo-client
    profiles: ["cli", "demo"]
    env_file:
      - ./.env
    environment:
      - INCEPTION_URL=http://inception:8005
      - DOCTOR_URL=http://doctor:5050
    volumes:
      - ./client/files:/app/files
      - ./client/src:/app/src
      - ./client/examples:/app/examples
    depends_on:
      - inception-cpu

networks:
  default:
